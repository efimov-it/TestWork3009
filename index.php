<?php


    get_header();
?>

        <?php
            $rand_products = get_posts([
                'post_type' => 'product',
                'posts_per_page' => 3,
                'orderby' => 'rand',
                'meta_query' => array(
                    array(
                        'key' => '_date_of_adding',
                        'value' => date('Y-m-d', time()),
                        'compare' => '=',
                    )
                )
            ]);

            
            if (count($rand_products) > 0) {
                ?>
                
            <section class="products-grid hidden-mob">
                <h2 class="hidden"></h2>

                <div class="products-grid_grid">

                <?php
                    foreach ($rand_products as $key => $product) {
                        
                        $image_mobile = wp_get_attachment_image_src( get_post_thumbnail_id( $product -> ID ), 'product-mobile' );
                        $image = wp_get_attachment_image_src( get_post_thumbnail_id( $product -> ID ), 'product-desktop' );

                        $wc_data = wc_get_product($product -> ID);



                        ?>
                        <article class="product-card">
                            <picture class="product-card_preview">
                                <source srcset="<?=$image_mobile[0]?>" type="image/jpeg" media="max-width: 920px"/>
                                <img src="<?=$image[0]?>" alt="<?=$product -> post_title?>" width="200px" height="200px">
                            </picture>
    
                            <h2 class="product-card_title">
                                <?=$product -> post_title?>
                            </h2>
    
                            <p class="product-card_info">
                                <?=get_post_meta ( $product->ID , '_weight_field', true )?>г. <?=get_post_meta ( $product->ID , '_calory_field', true )?>Ккал
                            </p>
    
                            <button class="product-card_button" type="button" aria-label="Добавить в корзину за 8,99 €"
                                data-product='{
                                    "id": <?=$product -> ID?>,
                                    "name": "<?=$product -> post_title?>",
                                    "image": {
                                        "mobile": "<?=$image_mobile[0]?>",
                                        "desktop": "<?=$image[0]?>"
                                    },
                                    "price": <?=$wc_data->get_price()?>
                                }'
                            >
                                <svg class="product-card_button-icon" xmlns="http://www.w3.org/2000/svg" width="29" height="28" viewBox="0 0 29 28" fill="none">
                                    <path d="M9.4165 21C9.88063 21 10.3258 21.1844 10.6539 21.5126C10.9821 21.8408 11.1665 22.2859 11.1665 22.75C11.1665 23.2141 10.9821 23.6592 10.6539 23.9874C10.3258 24.3156 9.88063 24.5 9.4165 24.5C8.95238 24.5 8.50726 24.3156 8.17907 23.9874C7.85088 23.6592 7.6665 23.2141 7.6665 22.75C7.6665 22.2859 7.85088 21.8408 8.17907 21.5126C8.50726 21.1844 8.95238 21 9.4165 21ZM19.9165 21C20.3806 21 20.8258 21.1844 21.1539 21.5126C21.4821 21.8408 21.6665 22.2859 21.6665 22.75C21.6665 23.2141 21.4821 23.6592 21.1539 23.9874C20.8258 24.3156 20.3806 24.5 19.9165 24.5C19.4524 24.5 19.0073 24.3156 18.6791 23.9874C18.3509 23.6592 18.1665 23.2141 18.1665 22.75C18.1665 22.2859 18.3509 21.8408 18.6791 21.5126C19.0073 21.1844 19.4524 21 19.9165 21Z" fill="#100E05"/>
                                    <path opacity="0.5" d="M3.09767 3.20953C3.1746 2.99064 3.33531 2.81126 3.54446 2.71084C3.75361 2.61042 3.99409 2.59718 4.21301 2.67403L4.56417 2.79769C5.28401 3.05086 5.89417 3.26553 6.37601 3.50119C6.88934 3.75436 7.33034 4.06469 7.66167 4.55003C7.99067 5.03069 8.12717 5.55919 8.18901 6.13903C8.21701 6.39803 8.23217 6.68503 8.24034 7.00003H20.6513C22.6172 7.00003 24.387 7.00003 24.905 7.67319C25.423 8.34636 25.22 9.36136 24.8152 11.3902L24.2318 14.2194C23.8643 16.002 23.6812 16.8945 23.0372 17.4184C22.3932 17.9434 21.4832 17.9434 19.662 17.9434H13.4752C10.2202 17.9434 8.59384 17.9434 7.58351 16.877C6.57317 15.8107 6.49851 14.679 6.49851 11.2467V8.21103C6.49851 7.34769 6.49851 6.77019 6.44951 6.32686C6.40284 5.90336 6.32234 5.69103 6.21617 5.53703C6.11467 5.38653 5.95951 5.24536 5.60484 5.07269C5.22801 4.88836 4.71584 4.70636 3.93651 4.43219L3.63317 4.32603C3.52455 4.28806 3.42448 4.22904 3.3387 4.15235C3.25291 4.07566 3.1831 3.9828 3.13325 3.8791C3.0834 3.77539 3.05449 3.66287 3.04819 3.54797C3.04188 3.43308 3.0583 3.31807 3.09651 3.20953H3.09767Z" fill="#100E05"/>
                                    <path d="M16.7078 10.5C16.7078 10.2679 16.6157 10.0454 16.4516 9.88128C16.2875 9.71719 16.0649 9.625 15.8328 9.625C15.6008 9.625 15.3782 9.71719 15.2141 9.88128C15.05 10.0454 14.9578 10.2679 14.9578 10.5V11.9583H13.4995C13.2674 11.9583 13.0449 12.0505 12.8808 12.2146C12.7167 12.3787 12.6245 12.6013 12.6245 12.8333C12.6245 13.0654 12.7167 13.288 12.8808 13.4521C13.0449 13.6161 13.2674 13.7083 13.4995 13.7083H14.9578V15.1667C14.9578 15.3987 15.05 15.6213 15.2141 15.7854C15.3782 15.9495 15.6008 16.0417 15.8328 16.0417C16.0649 16.0417 16.2875 15.9495 16.4516 15.7854C16.6157 15.6213 16.7078 15.3987 16.7078 15.1667V13.7083H18.1662C18.3982 13.7083 18.6208 13.6161 18.7849 13.4521C18.949 13.288 19.0412 13.0654 19.0412 12.8333C19.0412 12.6013 18.949 12.3787 18.7849 12.2146C18.6208 12.0505 18.3982 11.9583 18.1662 11.9583H16.7078V10.5Z" fill="#100E05"/>
                                </svg>
    
                                <span class="product-card_button-price"><?=$wc_data->get_price()?> €</span>
                            </button>
                        </article>
                        <?php
                    }
                ?>

                </div>
            </section>
                <?php
            }
        ?>

        <?php
            $today_products = get_posts([
                'post_type' => 'product',
                'posts_per_page' => -1,
                'meta_query' => array(
                    array(
                        'key' => '_date_of_adding',
                        'value' => date('Y-m-d', time()),
                        'compare' => '=',
                    )
                )
            ]);

            
            if (count($today_products) > 0) {
                ?>
                
            <section class="products-grid">
                <h2 class="products-grid_title">Сегодня в меню</h2>

                <div class="products-grid_grid">

                <?php
                    foreach ($today_products as $key => $product) {
                        
                        $image_mobile = wp_get_attachment_image_src( get_post_thumbnail_id( $product -> ID ), 'product-mobile' );
                        $image = wp_get_attachment_image_src( get_post_thumbnail_id( $product -> ID ), 'product-desktop' );

                        $wc_data = wc_get_product($product -> ID);



                        ?>
                        <article class="product-card">
                            <picture class="product-card_preview">
                                <source srcset="<?=$image_mobile[0]?>" type="image/jpeg" media="max-width: 920px"/>
                                <img src="<?=$image[0]?>" alt="<?=$product -> post_title?>" width="200px" height="200px">
                            </picture>
    
                            <h2 class="product-card_title">
                                <?=$product -> post_title?>
                            </h2>
    
                            <p class="product-card_info">
                                <?=get_post_meta ( $product->ID , '_weight_field', true )?>г. <?=get_post_meta ( $product->ID , '_calory_field', true )?>Ккал
                            </p>
    
                            <button class="product-card_button" type="button" aria-label="Добавить в корзину за 8,99 €"
                                data-product='{
                                    "id": <?=$product -> ID?>,
                                    "name": "<?=$product -> post_title?>",
                                    "image": {
                                        "mobile": "<?=$image_mobile[0]?>",
                                        "desktop": "<?=$image[0]?>"
                                    },
                                    "price": <?=$wc_data->get_price()?>
                                }'
                            >
                                <svg class="product-card_button-icon" xmlns="http://www.w3.org/2000/svg" width="29" height="28" viewBox="0 0 29 28" fill="none">
                                    <path d="M9.4165 21C9.88063 21 10.3258 21.1844 10.6539 21.5126C10.9821 21.8408 11.1665 22.2859 11.1665 22.75C11.1665 23.2141 10.9821 23.6592 10.6539 23.9874C10.3258 24.3156 9.88063 24.5 9.4165 24.5C8.95238 24.5 8.50726 24.3156 8.17907 23.9874C7.85088 23.6592 7.6665 23.2141 7.6665 22.75C7.6665 22.2859 7.85088 21.8408 8.17907 21.5126C8.50726 21.1844 8.95238 21 9.4165 21ZM19.9165 21C20.3806 21 20.8258 21.1844 21.1539 21.5126C21.4821 21.8408 21.6665 22.2859 21.6665 22.75C21.6665 23.2141 21.4821 23.6592 21.1539 23.9874C20.8258 24.3156 20.3806 24.5 19.9165 24.5C19.4524 24.5 19.0073 24.3156 18.6791 23.9874C18.3509 23.6592 18.1665 23.2141 18.1665 22.75C18.1665 22.2859 18.3509 21.8408 18.6791 21.5126C19.0073 21.1844 19.4524 21 19.9165 21Z" fill="#100E05"/>
                                    <path opacity="0.5" d="M3.09767 3.20953C3.1746 2.99064 3.33531 2.81126 3.54446 2.71084C3.75361 2.61042 3.99409 2.59718 4.21301 2.67403L4.56417 2.79769C5.28401 3.05086 5.89417 3.26553 6.37601 3.50119C6.88934 3.75436 7.33034 4.06469 7.66167 4.55003C7.99067 5.03069 8.12717 5.55919 8.18901 6.13903C8.21701 6.39803 8.23217 6.68503 8.24034 7.00003H20.6513C22.6172 7.00003 24.387 7.00003 24.905 7.67319C25.423 8.34636 25.22 9.36136 24.8152 11.3902L24.2318 14.2194C23.8643 16.002 23.6812 16.8945 23.0372 17.4184C22.3932 17.9434 21.4832 17.9434 19.662 17.9434H13.4752C10.2202 17.9434 8.59384 17.9434 7.58351 16.877C6.57317 15.8107 6.49851 14.679 6.49851 11.2467V8.21103C6.49851 7.34769 6.49851 6.77019 6.44951 6.32686C6.40284 5.90336 6.32234 5.69103 6.21617 5.53703C6.11467 5.38653 5.95951 5.24536 5.60484 5.07269C5.22801 4.88836 4.71584 4.70636 3.93651 4.43219L3.63317 4.32603C3.52455 4.28806 3.42448 4.22904 3.3387 4.15235C3.25291 4.07566 3.1831 3.9828 3.13325 3.8791C3.0834 3.77539 3.05449 3.66287 3.04819 3.54797C3.04188 3.43308 3.0583 3.31807 3.09651 3.20953H3.09767Z" fill="#100E05"/>
                                    <path d="M16.7078 10.5C16.7078 10.2679 16.6157 10.0454 16.4516 9.88128C16.2875 9.71719 16.0649 9.625 15.8328 9.625C15.6008 9.625 15.3782 9.71719 15.2141 9.88128C15.05 10.0454 14.9578 10.2679 14.9578 10.5V11.9583H13.4995C13.2674 11.9583 13.0449 12.0505 12.8808 12.2146C12.7167 12.3787 12.6245 12.6013 12.6245 12.8333C12.6245 13.0654 12.7167 13.288 12.8808 13.4521C13.0449 13.6161 13.2674 13.7083 13.4995 13.7083H14.9578V15.1667C14.9578 15.3987 15.05 15.6213 15.2141 15.7854C15.3782 15.9495 15.6008 16.0417 15.8328 16.0417C16.0649 16.0417 16.2875 15.9495 16.4516 15.7854C16.6157 15.6213 16.7078 15.3987 16.7078 15.1667V13.7083H18.1662C18.3982 13.7083 18.6208 13.6161 18.7849 13.4521C18.949 13.288 19.0412 13.0654 19.0412 12.8333C19.0412 12.6013 18.949 12.3787 18.7849 12.2146C18.6208 12.0505 18.3982 11.9583 18.1662 11.9583H16.7078V10.5Z" fill="#100E05"/>
                                </svg>
    
                                <span class="product-card_button-price"><?=$wc_data->get_price()?> €</span>
                            </button>
                        </article>
                        <?php
                    }
                ?>

                </div>
            </section>
                <?php
            }
        ?>

        <?php
            $last_products = get_posts([
                'post_type' => 'product',
                'posts_per_page' => -1,
                'meta_query' => array(
                    array(
                        'key' => '_date_of_adding',
                        'value' => date('Y-m-d', time()),
                        'compare' => '<',
                    )
                )
            ]);

            
            if (count($last_products) > 0) {
                ?>
                
            <section class="products-grid">
                <h2 class="products-grid_title">Также у нас бывают</h2>

                <div class="products-grid_grid">

                <?php
                    foreach ($last_products as $key => $product) {
                        
                        $image_mobile = wp_get_attachment_image_src( get_post_thumbnail_id( $product -> ID ), 'product-mobile' );
                        $image = wp_get_attachment_image_src( get_post_thumbnail_id( $product -> ID ), 'product-desktop' );

                        $wc_data = wc_get_product($product -> ID);



                        ?>
                        <article class="product-card">
                            <picture class="product-card_preview">
                                <source srcset="<?=$image_mobile[0]?>" type="image/jpeg" media="max-width: 920px"/>
                                <img src="<?=$image[0]?>" alt="<?=$product -> post_title?>" width="200px" height="200px">
                            </picture>
    
                            <h2 class="product-card_title">
                                <?=$product -> post_title?>
                            </h2>
    
                            <p class="product-card_info">
                                <?=get_post_meta ( $product->ID , '_weight_field', true )?>г. <?=get_post_meta ( $product->ID , '_calory_field', true )?>Ккал
                            </p>
    
                            <?php /*
                            <button class="product-card_button" type="button" aria-label="Добавить в корзину за 8,99 €"
                                data-product='{
                                    "id": <?=$product -> ID?>,
                                    "name": "<?=$product -> post_title?>",
                                    "image": {
                                        "mobile": "<?=$image_mobile[0]?>",
                                        "desktop": "<?=$image[0]?>"
                                    },
                                    "price": <?=$wc_data->get_price()?>
                                }'
                            >
                                <svg class="product-card_button-icon" xmlns="http://www.w3.org/2000/svg" width="29" height="28" viewBox="0 0 29 28" fill="none">
                                    <path d="M9.4165 21C9.88063 21 10.3258 21.1844 10.6539 21.5126C10.9821 21.8408 11.1665 22.2859 11.1665 22.75C11.1665 23.2141 10.9821 23.6592 10.6539 23.9874C10.3258 24.3156 9.88063 24.5 9.4165 24.5C8.95238 24.5 8.50726 24.3156 8.17907 23.9874C7.85088 23.6592 7.6665 23.2141 7.6665 22.75C7.6665 22.2859 7.85088 21.8408 8.17907 21.5126C8.50726 21.1844 8.95238 21 9.4165 21ZM19.9165 21C20.3806 21 20.8258 21.1844 21.1539 21.5126C21.4821 21.8408 21.6665 22.2859 21.6665 22.75C21.6665 23.2141 21.4821 23.6592 21.1539 23.9874C20.8258 24.3156 20.3806 24.5 19.9165 24.5C19.4524 24.5 19.0073 24.3156 18.6791 23.9874C18.3509 23.6592 18.1665 23.2141 18.1665 22.75C18.1665 22.2859 18.3509 21.8408 18.6791 21.5126C19.0073 21.1844 19.4524 21 19.9165 21Z" fill="#100E05"/>
                                    <path opacity="0.5" d="M3.09767 3.20953C3.1746 2.99064 3.33531 2.81126 3.54446 2.71084C3.75361 2.61042 3.99409 2.59718 4.21301 2.67403L4.56417 2.79769C5.28401 3.05086 5.89417 3.26553 6.37601 3.50119C6.88934 3.75436 7.33034 4.06469 7.66167 4.55003C7.99067 5.03069 8.12717 5.55919 8.18901 6.13903C8.21701 6.39803 8.23217 6.68503 8.24034 7.00003H20.6513C22.6172 7.00003 24.387 7.00003 24.905 7.67319C25.423 8.34636 25.22 9.36136 24.8152 11.3902L24.2318 14.2194C23.8643 16.002 23.6812 16.8945 23.0372 17.4184C22.3932 17.9434 21.4832 17.9434 19.662 17.9434H13.4752C10.2202 17.9434 8.59384 17.9434 7.58351 16.877C6.57317 15.8107 6.49851 14.679 6.49851 11.2467V8.21103C6.49851 7.34769 6.49851 6.77019 6.44951 6.32686C6.40284 5.90336 6.32234 5.69103 6.21617 5.53703C6.11467 5.38653 5.95951 5.24536 5.60484 5.07269C5.22801 4.88836 4.71584 4.70636 3.93651 4.43219L3.63317 4.32603C3.52455 4.28806 3.42448 4.22904 3.3387 4.15235C3.25291 4.07566 3.1831 3.9828 3.13325 3.8791C3.0834 3.77539 3.05449 3.66287 3.04819 3.54797C3.04188 3.43308 3.0583 3.31807 3.09651 3.20953H3.09767Z" fill="#100E05"/>
                                    <path d="M16.7078 10.5C16.7078 10.2679 16.6157 10.0454 16.4516 9.88128C16.2875 9.71719 16.0649 9.625 15.8328 9.625C15.6008 9.625 15.3782 9.71719 15.2141 9.88128C15.05 10.0454 14.9578 10.2679 14.9578 10.5V11.9583H13.4995C13.2674 11.9583 13.0449 12.0505 12.8808 12.2146C12.7167 12.3787 12.6245 12.6013 12.6245 12.8333C12.6245 13.0654 12.7167 13.288 12.8808 13.4521C13.0449 13.6161 13.2674 13.7083 13.4995 13.7083H14.9578V15.1667C14.9578 15.3987 15.05 15.6213 15.2141 15.7854C15.3782 15.9495 15.6008 16.0417 15.8328 16.0417C16.0649 16.0417 16.2875 15.9495 16.4516 15.7854C16.6157 15.6213 16.7078 15.3987 16.7078 15.1667V13.7083H18.1662C18.3982 13.7083 18.6208 13.6161 18.7849 13.4521C18.949 13.288 19.0412 13.0654 19.0412 12.8333C19.0412 12.6013 18.949 12.3787 18.7849 12.2146C18.6208 12.0505 18.3982 11.9583 18.1662 11.9583H16.7078V10.5Z" fill="#100E05"/>
                                </svg>
    
                                <span class="product-card_button-price"><?=$wc_data->get_price()?> €</span>
                            </button> */ ?>
                        </article>
                        <?php
                    }
                ?>

                </div>
            </section>
                <?php
            }
        ?>

<?php
    get_footer();

?>